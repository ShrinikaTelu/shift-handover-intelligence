<div class="handover-form-container">
    <div class="form-card">
        <h2>üè≠ Shift Handover Intelligence</h2>
        <p class="subtitle">Generate structured handover summaries with AI</p>

        <form (ngSubmit)="onSubmit()" #handoverForm="ngForm">
            <!-- Shift Notes -->
            <div class="form-group">
                <label for="shiftNotes">
                    <strong>Shift Notes</strong> <span class="required">*</span>
                </label>
                <textarea
                    id="shiftNotes"
                    [(ngModel)]="shiftNotes"
                    name="shiftNotes"
                    rows="12"
                    placeholder="Enter shift handover notes here...

Example:
- Equipment status
- Alarms and incidents
- Production metrics
- Issues and concerns
- Actions taken"
                    required
                    [disabled]="isLoading || isRecording"
                ></textarea>

                <!-- Voice Recording Section -->
                <div class="voice-recording-section">
                    <div class="voice-controls">
                        <!-- Start Recording Button -->
                        <button
                            type="button"
                            class="voice-button"
                            [disabled]="isLoading"
                            (click)="startRecording()"
                            *ngIf="!isRecording && !recordingAudioUrl"
                        >
                            <svg class="microphone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 1a3 3 0 0 0-3 3v12a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                            <span class="voice-label">Start Recording</span>
                        </button>

                        <!-- Recording Container (shows when recording) -->
                        <div class="recording-container" *ngIf="isRecording">
                            <div class="recording-info">
                                <span class="recording-indicator">‚óè Recording</span>
                                <span class="recording-timer">{{ formatTime(recordingTime) }}</span>
                            </div>

                            <div class="recording-button-group">
                                <button
                                    type="button"
                                    class="btn-stop-recording"
                                    (click)="stopRecording()"
                                >
                                    Stop Recording
                                </button>

                                <button
                                    type="button"
                                    class="btn-cancel-during-recording"
                                    (click)="cancelRecording()"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Playback Controls (shows after recording stops) -->
                        <div class="playback-container" *ngIf="!isRecording && recordingAudioUrl && !recordingConfirmed">
                            <!-- Playback Panel -->
                            <div class="playback-panel">
                                <!-- Control Row: Play Button + Progress + Time -->
                                <div class="playback-control-row">
                                    <!-- Play/Pause Button -->
                                    <button
                                        type="button"
                                        class="btn-play-pause"
                                        (click)="togglePlayPause()"
                                        [disabled]="isPreparing"
                                    >
                                        <span class="play-icon">{{ isPlaying ? '‚è∏' : '‚ñ∂' }}</span>
                                    </button>

                                    <!-- Progress Section -->
                                    <div class="playback-progress">
                                        <!-- Current Time -->
                                        <span class="time-label">{{ formatTime(currentTime) }}</span>

                                        <!-- Progress Bar -->
                                        <div
                                            class="progress-bar-container"
                                            (click)="onProgressBarClick($event)"
                                        >
                                            <div
                                                class="progress-bar"
                                                [style.width.%]="progress"
                                                [class.buffering]="isPreparing"
                                            ></div>
                                        </div>

                                        <!-- Duration -->
                                        <span class="time-label">{{ formatTime(duration) }}</span>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="playback-button-group">
                                    <button
                                        type="button"
                                        class="btn-action btn-use"
                                        (click)="confirmRecording()"
                                    >
                                        Use Recording
                                    </button>
                                    <button
                                        type="button"
                                        class="btn-action btn-replay"
                                        (click)="replayRecording()"
                                    >
                                        Replay
                                    </button>
                                    <button
                                        type="button"
                                        class="btn-action btn-cancel"
                                        (click)="cancelRecording()"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Recording Confirmed State -->
                        <div class="recording-confirmed-panel" *ngIf="!isRecording && recordingAudioUrl && recordingConfirmed">
                            <div class="confirmed-indicator">
                                <span class="confirmed-icon">‚úÖ</span>
                                <span class="confirmed-text">Recording saved and added to shift notes</span>
                            </div>
                            <button
                                type="button"
                                class="btn-new-recording"
                                (click)="clearRecording()"
                            >
                                <span>üé§ Record Another</span>
                            </button>
                        </div>
                    </div>

                    <!-- Voice Recording Hint -->
                    <small class="voice-hint" *ngIf="!isRecording && !recordingAudioUrl">
                        Start recording and speak naturally. Your voice will be transcribed into the shift notes.
                    </small>
                </div>
            </div>

            <!-- Sample Data Buttons -->
            <div class="sample-buttons">
                <button
                    type="button"
                    (click)="loadSampleData(1)"
                    class="btn-sample"
                    [disabled]="isLoading"
                >
                    üìù Sample 1: Normal Ops
                </button>
                <button
                    type="button"
                    (click)="loadSampleData(2)"
                    class="btn-sample"
                    [disabled]="isLoading"
                >
                    ‚ö†Ô∏è Sample 2: Pump Failure
                </button>
                <button
                    type="button"
                    (click)="loadSampleData(3)"
                    class="btn-sample"
                    [disabled]="isLoading"
                >
                    üö® Sample 3: Reactor Trip
                </button>
            </div>

            <!-- File Uploads Side by Side -->
            <div class="file-uploads-row">
                <!-- Alarms JSON Upload -->
                <div class="form-group">
                    <label for="alarmsFile">
                        <strong>Alarms Data</strong>
                        <span class="optional">(optional)</span>
                    </label>
                    <div class="file-upload-wrapper">
                        <input
                            type="file"
                            id="alarmsFile"
                            (change)="onAlarmsFileChange($event)"
                            accept=".json"
                            [disabled]="isLoading"
                            class="file-input"
                        />
                        <label for="alarmsFile" class="file-upload-label">
                            <span class="upload-icon">üìÅ</span>
                            <span class="upload-text">Upload JSON</span>
                        </label>
                    </div>
                    <div *ngIf="alarmsFileName" class="file-uploaded-confirmation">
                        ‚úÖ Uploaded: {{ alarmsFileName }}
                    </div>
                </div>

                <!-- Trends CSV Upload -->
                <div class="form-group">
                    <label for="trendsFile">
                        <strong>Trend Data</strong>
                        <span class="optional">(optional)</span>
                    </label>
                    <div class="file-upload-wrapper">
                        <input
                            type="file"
                            id="trendsFile"
                            (change)="onTrendsFileChange($event)"
                            accept=".csv"
                            [disabled]="isLoading"
                            class="file-input"
                        />
                        <label for="trendsFile" class="file-upload-label">
                            <span class="upload-icon">üìä</span>
                            <span class="upload-text">Upload CSV</span>
                        </label>
                    </div>
                    <div *ngIf="trendsFileName" class="file-uploaded-confirmation">
                        ‚úÖ Uploaded: {{ trendsFileName }}
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="form-actions">
                <button
                    type="submit"
                    class="btn-primary"
                    [disabled]="!shiftNotes.trim() || isLoading"
                >
                    <span *ngIf="!isLoading">ü§ñ Generate Handover</span>
                    <span *ngIf="isLoading">
                        <span class="spinner"></span> Generating...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>


